<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="cppRnet">
<title>An opinionated way of working with OSM data • cppRnet</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="An opinionated way of working with OSM data">
<meta property="og:description" content="cppRnet">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">cppRnet</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/data_schema.html">An opinionated way of working with OSM data</a>
    <a class="dropdown-item" href="../articles/road_networks.html">Extracting road networks</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ischlo/cppRnet/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>An opinionated way of working with OSM data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ischlo/cppRnet/blob/HEAD/vignettes/data_schema.Rmd" class="external-link"><code>vignettes/data_schema.Rmd</code></a></small>
      <div class="d-none name"><code>data_schema.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Anyone who has used OpenStreetMap (OSM) data in R or python might
agree that the tagging system, while it provides great flexibility and
extensive classification options, is sometimes a bit challenging to work
with. This vignettes will explain the approach to the tagging system
that aims to make it easy to interact with features, their associated
tags and their geometries. The main ambition being providing an easy
access to large OSM data sets.</p>
</div>
<div class="section level2">
<h2 id="osm-tags">OSM tags<a class="anchor" aria-label="anchor" href="#osm-tags"></a>
</h2>
<p>A tag is a tuple of values, the first element is called a <span class="math inline">\(key\)</span>, while the second is the
corresponding <span class="math inline">\(value\)</span>. Together, they
form a tag which is written out as a <span class="math inline">\(key=value\)</span> form. The key corresponds to a
broad classification, while the value is specific. For example <span class="math inline">\(amenity=restaurant\)</span>. The <span class="math inline">\(key\)</span> is <span class="math inline">\(amenity\)</span>, while the <span class="math inline">\(value\)</span> is <span class="math inline">\(restaurant\)</span>. Generally, there is a few
values corresponding to a key. - Every OSM feature consists of a set of
nodes and a set of tags. The nodes are geographically referenced, which
means they have associated coordinates, allowing to reconstruct the
geometry of a feature. A detailed list of possible value and
recommendations are avaialbe in the following article : <a href="https://wiki.openstreetmap.org/wiki/Map_features#Primary_features" class="external-link">OSM
map features</a>.</p>
</div>
<div class="section level2">
<h2 id="different-data-types">Different data types<a class="anchor" aria-label="anchor" href="#different-data-types"></a>
</h2>
<p>To further develop the appropriate tools to work with OSM data, it is
important to have a look at what kind of data is actually there and in
what format it is most useful. Mainly two types of data can be
divided:</p>
<div class="section level3">
<h3 id="network">Network<a class="anchor" aria-label="anchor" href="#network"></a>
</h3>
<p>First, one main use of OSM data is to obtain connected and routable
road networks, an easy to use function called <code>extrat_graph</code>
will do that. See the corresponding vignette for details. The road
network data is grouped under the <span class="math inline">\(highway\)</span> key. All categories of roads
(residential,motorway,pedestrian etc…) will be values of this key.</p>
</div>
<div class="section level3">
<h3 id="non-network">Non network<a class="anchor" aria-label="anchor" href="#non-network"></a>
</h3>
<p>The rest of the data in OSM is usually represented by either a point
or a polygon with its set of associated tags. There can be multiple tags
associated to a feature, and one might be interested in the values of a
specific one. There is, however, an intrinsic hierarchy in the tags,
which can be useful in extracting data in a user friendly and
exploitable way.</p>
</div>
</div>
<div class="section level2">
<h2 id="tagging-hierarchy">Tagging hierarchy<a class="anchor" aria-label="anchor" href="#tagging-hierarchy"></a>
</h2>
<p>This package proposes a 2 level hierarchy of tags, which helps
extract the data into large data.tables or data.frames in which the high
level tags are added as column variables, while secondary tags are
grouped into named lists and added in a separate column called
<code>attrs</code>. The main consideration is that there are tags that
add up information to each other, being complimentary in that sense for
a feature, these are grouped in the 2nd level in this schema. While
there are also tags that are mutually exclusive, for example a tag with
an <span class="math inline">\(amenity\)</span> key will generally not
have a <span class="math inline">\(healthcare\)</span> key since these
are different types of features. While both of them can have the same
2nd level keys such as the address, name, phone number or any specific
information.</p>
<div class="section level3">
<h3 id="st-level">1st level<a class="anchor" aria-label="anchor" href="#st-level"></a>
</h3>
<p>The first level corresponds to the <em>main</em> tags. Those are
taken from the following list:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">main_first_level</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"amenity"</span></span>
<span>    ,<span class="st">"craft"</span></span>
<span>    ,<span class="st">"healthcare"</span></span>
<span>    ,<span class="st">"historic"</span></span>
<span>    ,<span class="st">"sport"</span></span>
<span>    ,<span class="st">"natural"</span></span>
<span>    ,<span class="st">"shop"</span></span>
<span>    ,<span class="st">"tourism"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="nd-level">2nd level<a class="anchor" aria-label="anchor" href="#nd-level"></a>
</h3>
<p>Everything else is left to the second level of tags, for example:
<span class="math inline">\(addr:street\)</span> is a specific key for
the address of a feature. It is generally scarce. <span class="math inline">\(leisure\)</span> is a key that overlaps a lot with
the <span class="math inline">\(sport\)</span> key. It generally
contains more specific information on the type of sport.</p>
</div>
<div class="section level3">
<h3 id="explanation">Explanation<a class="anchor" aria-label="anchor" href="#explanation"></a>
</h3>
<p>Accounting for the fact that OSM data is crowd sourced and therefore
there is somewhere an exception to any kind of rules that can imposed on
the data, one can still observe certain patterns that are generally
true, this is what this 2 level hierearchy of tags aims to capture. Some
observations are:</p>
<table class="table">
<colgroup>
<col width="63%">
<col width="36%">
</colgroup>
<thead><tr class="header">
<th>1st level</th>
<th>2nd level</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><ul>
<li><p>Tend to be mutually exclusive</p></li>
<li><p>Provide a certain amount of information, but remain sufficiently
broad.</p></li>
<li>
</ul></td>
<td><ul>
<li><p>a lot more specific</p></li>
<li><p>complement each other</p></li>
</ul></td>
</tr>
<tr class="even">
<td>amenity, shop, tourism etc</td>
<td>addr:name, addr:street, cuisine, takeaway</td>
</tr>
</tbody>
</table>
<p>Arguably, some tags don’t fall into any of these categories, yet you
can export them with the <code>export_data</code> function, such a tag
can be for the <span class="math inline">\(building\)</span> key. This
qualifies more as a layer of data, much like the road network.</p>
</div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>By default, only tags with keys <span class="math inline">\(amenity,shop,tourism\)</span> will be
extracted.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ischlo/cppRnet" class="external-link">cppRnet</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">test_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">'cppRnet'</span>,<span class="st">'extdata'</span>,<span class="st">'map.osm'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">cppRnet</span><span class="fu">::</span><span class="fu"><a href="../reference/extract_data.html">extract_data</a></span><span class="op">(</span><span class="va">test_file</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<p>The geometry is simplified to the centroid, for which the coordinates
are provided in the lon,lat columns of the data table. A function
allowing to reconstruct the full geometry is provided, but since it is
not necessarily always usefull to have it, it is ommited in a first
extraction. The nodes that constitute a full geometry, if it is more
complex than a point, are added to the attrs column as a
<code>data.frame</code>. These geometries are always closed, meaining
they are polygons. This is meant to save memory especially for large
data sets.</p>
<p>With this data format, we can now easily manipulate all the POIs, or
select specific keys, or specific values, or both.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filer by key</span></span>
<span><span class="va">data</span><span class="op">[</span><span class="va">key</span><span class="op">==</span><span class="st">"amenity"</span>,<span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># filter by value</span></span>
<span><span class="va">data</span><span class="op">[</span><span class="va">value</span><span class="op">==</span><span class="st">"restaurant"</span>,<span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># both: use or to include specific values of different keys and keys</span></span>
<span><span class="va">data</span><span class="op">[</span><span class="va">key</span><span class="op">==</span><span class="st">"shop"</span> <span class="op">|</span> <span class="va">value</span><span class="op">==</span><span class="st">"restaurant"</span>,<span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="filtering-2nd-level-tags">Filtering 2nd level tags<a class="anchor" aria-label="anchor" href="#filtering-2nd-level-tags"></a>
</h2>
<p>A function to efficiently filter the secondary tags returns a data
frame, where the searched for key will be added as a column for all
feature that has a non-<code>NA</code> match. Under the hood, values are
matched using regular expressions, which maximises the chance of finding
the desired values in sometimes complicated OSM values.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">cppRnet</span><span class="fu">::</span><span class="fu"><a href="../reference/filter_sec.html">filter_sec</a></span><span class="op">(</span>keys<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cuisine"</span>,<span class="st">"takeaway"</span><span class="op">)</span></span>
<span>                      ,cores<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">cppRnet</span><span class="fu">::</span><span class="fu"><a href="../reference/filter_sec.html">filter_sec</a></span><span class="op">(</span>keys<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"cuisine"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"japanese"</span>,<span class="st">"pizza"</span><span class="op">)</span></span>
<span>                                ,<span class="st">"takeaway"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yes"</span><span class="op">)</span><span class="op">)</span></span>
<span>                      ,cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="geometries">Geometries<a class="anchor" aria-label="anchor" href="#geometries"></a>
</h2>
<p>In a lot of cases, knowing the centroids of POIs is more than
enough:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>,<span class="st">"lat"</span><span class="op">)</span>,crs<span class="op">=</span><span class="fl">4326</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># or same result, keeping the original data a `data.table`</span></span>
<span><span class="co"># data |&gt; </span></span>
<span><span class="co">#   cppRnet::construct_geom() |&gt; </span></span>
<span><span class="co">#   sf::st_as_sf() |&gt; </span></span>
<span><span class="co">#   sf::st_geometry() |&gt; </span></span>
<span><span class="co">#   plot()</span></span></code></pre></div>
<p>But there will be times when the original geometry might be of
interest, in this case use the <code>construct_geom</code> function:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_geom</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">cppRnet</span><span class="fu">::</span><span class="fu"><a href="../reference/construct_geom.html">construct_geom</a></span><span class="op">(</span>complete <span class="op">=</span> <span class="cn">TRUE</span>,cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_geom</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="buildings">Buildings<a class="anchor" aria-label="anchor" href="#buildings"></a>
</h2>
<p>As discussed earlier, the tags withe the <span class="math inline">\(building\)</span> key arguably fall into neither
categories, and in that sense they constitute a data layer, just like
the road network. They can still be queried and extracted with the
<code>extract_data</code> function.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">buildings</span> <span class="op">&lt;-</span> <span class="fu">cppRnet</span><span class="fu">::</span><span class="fu"><a href="../reference/extract_data.html">extract_data</a></span><span class="op">(</span><span class="va">test_file</span>,main_keys <span class="op">=</span> <span class="st">"building"</span><span class="op">)</span></span></code></pre></div>
<p>This function will run in a fraction of seconds and extract all the
buildings from the file. It will again only provide the centroid in
direct access:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">buildings</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">cppRnet</span><span class="fu">::</span><span class="fu"><a href="../reference/construct_geom.html">construct_geom</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_set_geometry</a></span><span class="op">(</span><span class="st">"geometry"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>And we can reconstruct the geometries from the data hidden in
<code>attrs</code> as follows:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">buildings</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">cppRnet</span><span class="fu">::</span><span class="fu"><a href="../reference/construct_geom.html">construct_geom</a></span><span class="op">(</span>complete <span class="op">=</span> <span class="cn">TRUE</span>,cores<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We can filter for specific tags:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">buildings</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">cppRnet</span><span class="fu">::</span><span class="fu"><a href="../reference/filter_sec.html">filter_sec</a></span><span class="op">(</span>keys<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"shop"</span>,<span class="st">"amenity"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We observe the mutually exclusive nature of <span class="math inline">\(amenity\)</span> and <span class="math inline">\(shop\)</span> keys, justifying the earlier
discussion and the differentiation of the <span class="math inline">\(building\)</span> key. The only intersection of
the two keys is the famous in french <em>bar-tabac</em>, which is both a
bar and a place to buy tobacco/cigarettes.</p>
<p>More specific filtering:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">buildings</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">cppRnet</span><span class="fu">::</span><span class="fu"><a href="../reference/filter_sec.html">filter_sec</a></span><span class="op">(</span>keys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"tourism"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span>
<span>                         ,<span class="st">"abandoned"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yes"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>If searching for a specific <span class="math inline">\(key=value\)</span> in one tag and all values for
another tag, consider the trick above.</p>
<ul>
<li>It’s generally not recommended to extract the building layer
together with other main keys.</li>
</ul>
</div>
<div class="section level2">
<h2 id="alternatives">Alternatives<a class="anchor" aria-label="anchor" href="#alternatives"></a>
</h2>
<ul>
<li>
<code>osmdata</code>: while this is a great package that I have used
a lot, I found it frustrating to have all the different geometries
gathered into separate tables, and each table containing huge numbers of
<code>NA</code> columns. The <code>attrs</code> column in a cppRnet
table provides an alternative way to store all the secondary tags.
Additionally, all the geometries are simplified to their centroid, but
the possibility to reconstruct the original ones are provided with the
<code>construct_geom</code> function.</li>
<li>
<code>osmextract</code>: great for working with large OSM files. But
the filtering of features remains a bit obscure in my opinion, although
it seems to provide great flexibility, but requires a good knowledge of
OSM internals.</li>
</ul>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>This vignette aimed to explain the approach taken for manipulating
OSM data at scale and with flexibility through a specific data table
format and supporting functions. Please reach out for recommendations,
feature additions etc…</p>
<p>In another vignette, a recommended workflow will be covered, as this
package was developed with a few others in mind
(<code>rosmium</code>,<code>cppRouting</code> mainly) , so that network
and POI analysis could be done at scale in a local setup.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ivann Schlosser.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
