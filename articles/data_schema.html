<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>An opinionated way of working with OSM data • cppRosm</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="An opinionated way of working with OSM data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cppRosm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/data_schema.html">An opinionated way of working with OSM data</a></li>
    <li><a class="dropdown-item" href="../articles/road_networks.html">Extracting road networks</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ischlo/cppRosm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>An opinionated way of working with OSM data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ischlo/cppRosm/blob/main/vignettes/data_schema.Rmd" class="external-link"><code>vignettes/data_schema.Rmd</code></a></small>
      <div class="d-none name"><code>data_schema.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Anyone who has used OpenStreetMap (OSM) data in R or python might
agree that the tagging system, while it provides great flexibility and
extensive classification options, is sometimes a bit challenging to work
with. This vignettes will explain the approach to the tagging system
that aims to make it easy to interact with features, their associated
tags and their geometries. The main ambition being providing an easy
access to large OSM data sets.</p>
</div>
<div class="section level2">
<h2 id="osm-tags">OSM tags<a class="anchor" aria-label="anchor" href="#osm-tags"></a>
</h2>
<p>A tag is a tuple of values, the first element is called a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mi>e</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">key</annotation></semantics></math>,
while the second is the corresponding
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">value</annotation></semantics></math>.
Together, they form a tag which is written out as a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mi>e</mi><mi>y</mi><mo>=</mo><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">key=value</annotation></semantics></math>
form. The key corresponds to a broad classification, while the value is
specific. For example
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo>=</mo><mi>r</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">amenity=restaurant</annotation></semantics></math>.
The
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mi>e</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">key</annotation></semantics></math>
is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>i</mi><mi>t</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">amenity</annotation></semantics></math>,
while the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">value</annotation></semantics></math>
is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">restaurant</annotation></semantics></math>.
Generally, there are a few values corresponding to a key. - Every OSM
feature consists of a set of nodes and a set of tags. The nodes are
geographically referenced, which means they have associated coordinates,
allowing to reconstruct the geometry of a feature. A detailed list of
possible values and recommendations are available in the following
article : <a href="https://wiki.openstreetmap.org/wiki/Map_features#Primary_features" class="external-link">OSM
map features</a>.</p>
</div>
<div class="section level2">
<h2 id="different-data-types">Different data types<a class="anchor" aria-label="anchor" href="#different-data-types"></a>
</h2>
<p>To further develop the appropriate tools to work with OSM data, it is
important to have a look at what kind of data is actually there and in
what format it is most useful. Mainly two types of data can be
divided:</p>
<div class="section level3">
<h3 id="network">Network<a class="anchor" aria-label="anchor" href="#network"></a>
</h3>
<p>First, one main use of OSM data is to obtain connected and routable
road networks, an easy to use function called <code>extrat_graph</code>
will do that. See the corresponding vignette for details. The road
network data is grouped under the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>w</mi><mi>a</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">highway</annotation></semantics></math>
key. All categories of roads (residential,motorway,pedestrian etc…) will
be values of this key.</p>
</div>
<div class="section level3">
<h3 id="non-network">Non network<a class="anchor" aria-label="anchor" href="#non-network"></a>
</h3>
<p>The rest of the data in OSM is usually represented by either a point
or a polygon with its set of associated tags. There can be multiple tags
associated to a feature, and one might be interested in the values of a
specific one. There is, however, an intrinsic hierarchy in the tags,
which can be useful in extracting data in a user friendly and
exploitable way.</p>
</div>
</div>
<div class="section level2">
<h2 id="tagging-hierarchy">Tagging hierarchy<a class="anchor" aria-label="anchor" href="#tagging-hierarchy"></a>
</h2>
<p>This package proposes a 2 level hierarchy of tags, which helps
extract the data into large data.tables or data.frames in which the high
level tags are added as column variables, while secondary tags are
grouped into named lists and added in a separate column called
<code>attrs</code>. The main consideration is that there are tags that
add up information to each other, being complimentary in that sense for
a feature, these are grouped in the 2nd level in this schema. While
there are also tags that are mutually exclusive, for example a tag with
an
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>i</mi><mi>t</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">amenity</annotation></semantics></math>
key will generally not have a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi>e</mi><mi>a</mi><mi>l</mi><mi>t</mi><mi>h</mi><mi>c</mi><mi>a</mi><mi>r</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">healthcare</annotation></semantics></math>
key since these are different types of features. While both of them can
have the same 2nd level keys such as the address, name, phone number or
any specific information.</p>
<div class="section level3">
<h3 id="st-level">1st level<a class="anchor" aria-label="anchor" href="#st-level"></a>
</h3>
<p>The first level corresponds to the <em>main</em> tags. Those are
taken from the following list:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">main_first_level</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"amenity"</span></span>
<span>    ,<span class="st">"craft"</span></span>
<span>    ,<span class="st">"healthcare"</span></span>
<span>    ,<span class="st">"historic"</span></span>
<span>    ,<span class="st">"sport"</span></span>
<span>    ,<span class="st">"natural"</span></span>
<span>    ,<span class="st">"shop"</span></span>
<span>    ,<span class="st">"tourism"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="nd-level">2nd level<a class="anchor" aria-label="anchor" href="#nd-level"></a>
</h3>
<p>Everything else is left to the second level of tags, for example:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>d</mi><mi>d</mi><mi>r</mi><mo>:</mo><mi>s</mi><mi>t</mi><mi>r</mi><mi>e</mi><mi>e</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">addr:street</annotation></semantics></math>
is a specific key for the address of a feature. It is generally scarce.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>e</mi><mi>i</mi><mi>s</mi><mi>u</mi><mi>r</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">leisure</annotation></semantics></math>
is a key that overlaps a lot with the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>p</mi><mi>o</mi><mi>r</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">sport</annotation></semantics></math>
key. It generally contains more specific information on the type of
sport.</p>
</div>
<div class="section level3">
<h3 id="explanation">Explanation<a class="anchor" aria-label="anchor" href="#explanation"></a>
</h3>
<p>Accounting for the fact that OSM data is crowd sourced and therefore
there is somewhere an exception to any kind of rules that can imposed on
the data, one can still observe certain patterns that are generally
true, this is what this 2 level hierearchy of tags aims to capture. Some
observations are:</p>
<table class="table">
<colgroup>
<col width="63%">
<col width="36%">
</colgroup>
<thead><tr class="header">
<th>1st level</th>
<th>2nd level</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><ul>
<li><p>Tend to be mutually exclusive</p></li>
<li><p>Provide a certain amount of information, but remain sufficiently
broad.</p></li>
</ul></td>
<td><ul>
<li><p>a lot more specific</p></li>
<li><p>complement each other</p></li>
</ul></td>
</tr>
<tr class="even">
<td>amenity, shop, tourism etc</td>
<td>addr:name, addr:street, cuisine, takeaway</td>
</tr>
</tbody>
</table>
<p>Arguably, some tags don’t fall into any of these categories, you can
still export them with the <code>export_data</code> function, such a tag
can be for the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mi>u</mi><mi>i</mi><mi>l</mi><mi>d</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow><annotation encoding="application/x-tex">building</annotation></semantics></math>
key. This qualifies more as a layer of data, much like the road
network.</p>
</div>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>By default, only tags with keys
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo>,</mo><mi>s</mi><mi>h</mi><mi>o</mi><mi>p</mi><mo>,</mo><mi>t</mi><mi>o</mi><mi>u</mi><mi>r</mi><mi>i</mi><mi>s</mi><mi>m</mi></mrow><annotation encoding="application/x-tex">amenity,shop,tourism</annotation></semantics></math>
will be extracted.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ischlo/cppRosm" class="external-link">cppRosm</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Linking to GEOS 3.10.2, GDAL 3.4.1, PROJ 8.2.1; sf_use_s2() is TRUE</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">'cppRosm'</span>,<span class="st">'extdata'</span>,<span class="st">'monaco-latest.osm.pbf'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">cppRosm</span><span class="fu">::</span><span class="fu"><a href="../reference/extract_data.html">extract_data</a></span><span class="op">(</span><span class="va">test_file</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## → Using main keys `amenity`,`shop`,`tourism`.</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="1%">
<col width="1%">
<col width="1%">
<col width="0%">
<col width="0%">
<col width="94%">
</colgroup>
<thead><tr class="header">
<th align="left">id</th>
<th align="left">key</th>
<th align="left">value</th>
<th align="right">lon</th>
<th align="right">lat</th>
<th align="left">attrs</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">25191432</td>
<td align="left">amenity</td>
<td align="left">parking</td>
<td align="right">7.427</td>
<td align="right">43.731</td>
<td align="left">yes , MC , yes , Parking du Chemin des Pêcheurs ,
multi-storey , ticket , <a href="https://documents.monaco-parkings.mc//park/_upl_12_Pecheurs.jpg" class="external-link uri">https://documents.monaco-parkings.mc//park/_upl_12_Pecheurs.jpg</a>
</td>
</tr>
<tr class="even">
<td align="left">25230434</td>
<td align="left">amenity</td>
<td align="left">fuel</td>
<td align="right">7.412</td>
<td align="right">43.729</td>
<td align="left">MC , Esso , Q867662, yes , yes , yes , yes , Esso</td>
</tr>
<tr class="odd">
<td align="left">25239190</td>
<td align="left">amenity</td>
<td align="left">parking</td>
<td align="right">7.429</td>
<td align="right">43.745</td>
<td align="left">MC , surface</td>
</tr>
<tr class="even">
<td align="left">25239191</td>
<td align="left">amenity</td>
<td align="left">parking</td>
<td align="right">7.418</td>
<td align="right">43.731</td>
<td align="left">yes , MC , yes , -1 , Parking du centre commercial,
underground</td>
</tr>
<tr class="odd">
<td align="left">267885777</td>
<td align="left">tourism</td>
<td align="left">hotel</td>
<td align="right">7.428</td>
<td align="right">43.741</td>
<td align="left">Monaco , MC , 4 , 98000 , Avenue de la Madone , <a href="mailto:metropole@metropole.com" class="email">metropole@metropole.com</a> , <a href="https://www.facebook.com/HotelMetropoleMonteCarlo/" class="external-link uri">https://www.facebook.com/HotelMetropoleMonteCarlo/</a>, wlan
, no , Metropole , +377 93 15 15 15 , 5 , <a href="https://www.metropole.com/" class="external-link uri">https://www.metropole.com/</a> , Q30681475</td>
</tr>
<tr class="even">
<td align="left">267885802</td>
<td align="left">amenity</td>
<td align="left">bank</td>
<td align="right">7.428</td>
<td align="right">43.742</td>
<td align="left">Monte-Carlo , MC , 98000 , Avenue de Grande-Bretagne,
UBS , Q193199 , en:UBS , yes , UBS</td>
</tr>
</tbody>
</table>
<p>The geometry is simplified to the centroid, for which the coordinates
are provided in the <em>lon</em>,<em>lat</em> columns of the data table.
A function allowing to reconstruct the full geometry is provided, but
since it is not necessarily always usefull to have it, it is ommited in
a first extraction. The nodes that constitute a full geometry, if it is
more complex than a point, are added to the attrs column as a
<code>data.frame</code>. These geometries are always closed, meaning
they are polygons. This is meant to save memory especially for large
data sets.</p>
<p>With this data format, we can now easily manipulate all the POIs, or
select specific keys, or specific values, or both.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filer by key</span></span>
<span><span class="va">data</span><span class="op">[</span><span class="va">key</span><span class="op">==</span><span class="st">"amenity"</span>,<span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="2%">
<col width="1%">
<col width="1%">
<col width="1%">
<col width="1%">
<col width="92%">
</colgroup>
<thead><tr class="header">
<th align="left">id</th>
<th align="left">key</th>
<th align="left">value</th>
<th align="right">lon</th>
<th align="right">lat</th>
<th align="left">attrs</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">25191432</td>
<td align="left">amenity</td>
<td align="left">parking</td>
<td align="right">7.427</td>
<td align="right">43.731</td>
<td align="left">yes , MC , yes , Parking du Chemin des Pêcheurs ,
multi-storey , ticket , <a href="https://documents.monaco-parkings.mc//park/_upl_12_Pecheurs.jpg" class="external-link uri">https://documents.monaco-parkings.mc//park/_upl_12_Pecheurs.jpg</a>
</td>
</tr>
<tr class="even">
<td align="left">25230434</td>
<td align="left">amenity</td>
<td align="left">fuel</td>
<td align="right">7.412</td>
<td align="right">43.729</td>
<td align="left">MC , Esso , Q867662, yes , yes , yes , yes , Esso</td>
</tr>
<tr class="odd">
<td align="left">25239190</td>
<td align="left">amenity</td>
<td align="left">parking</td>
<td align="right">7.429</td>
<td align="right">43.745</td>
<td align="left">MC , surface</td>
</tr>
<tr class="even">
<td align="left">25239191</td>
<td align="left">amenity</td>
<td align="left">parking</td>
<td align="right">7.418</td>
<td align="right">43.731</td>
<td align="left">yes , MC , yes , -1 , Parking du centre commercial,
underground</td>
</tr>
<tr class="odd">
<td align="left">267885802</td>
<td align="left">amenity</td>
<td align="left">bank</td>
<td align="right">7.428</td>
<td align="right">43.742</td>
<td align="left">Monte-Carlo , MC , 98000 , Avenue de Grande-Bretagne,
UBS , Q193199 , en:UBS , yes , UBS</td>
</tr>
<tr class="even">
<td align="left">267898764</td>
<td align="left">amenity</td>
<td align="left">parking</td>
<td align="right">7.429</td>
<td align="right">43.741</td>
<td align="left">MC , Metropole, yes</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filter by value</span></span>
<span><span class="va">data</span><span class="op">[</span><span class="va">value</span><span class="op">==</span><span class="st">"restaurant"</span>,<span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="1%">
<col width="1%">
<col width="1%">
<col width="0%">
<col width="0%">
<col width="94%">
</colgroup>
<thead><tr class="header">
<th align="left">id</th>
<th align="left">key</th>
<th align="left">value</th>
<th align="right">lon</th>
<th align="right">lat</th>
<th align="left">attrs</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">267901435</td>
<td align="left">amenity</td>
<td align="left">restaurant</td>
<td align="right">7.425</td>
<td align="right">43.733</td>
<td align="left">Monaco , MC , 6 , 98000 , Quai Antoine 1er , Stars ’n’
Bars , Mo-Su 11:00-00:00 , +377 97 97 95 95 , <a href="https://starsnbars.com/" class="external-link uri">https://starsnbars.com/</a>,
limited</td>
</tr>
<tr class="even">
<td align="left">267901573</td>
<td align="left">amenity</td>
<td align="left">restaurant</td>
<td align="right">7.424</td>
<td align="right">43.733</td>
<td align="left">MC , 4 , 98000 , Quai Antoine 1er , Quai des Artistes ,
Mo-Su 12:00-14:30, 19:30-23:00, +377 97 97 97 77 , <a href="https://quaidesartistes.com/" class="external-link uri">https://quaidesartistes.com/</a> , yes</td>
</tr>
<tr class="odd">
<td align="left">268166909</td>
<td align="left">amenity</td>
<td align="left">restaurant</td>
<td align="right">7.425</td>
<td align="right">43.741</td>
<td align="left">MC , Rue des Iris, Terrazino</td>
</tr>
<tr class="even">
<td align="left">274499623</td>
<td align="left">amenity</td>
<td align="left">restaurant</td>
<td align="right">7.430</td>
<td align="right">43.743</td>
<td align="left">MC</td>
</tr>
<tr class="odd">
<td align="left">274499808</td>
<td align="left">amenity</td>
<td align="left">restaurant</td>
<td align="right">7.430</td>
<td align="right">43.743</td>
<td align="left">MC</td>
</tr>
<tr class="even">
<td align="left">274500242</td>
<td align="left">amenity</td>
<td align="left">restaurant</td>
<td align="right">7.420</td>
<td align="right">43.732</td>
<td align="left">Monaco , MC , 4 , 98000 , Rue Terrazzani , <a href="mailto:pizzeriamonegasque@monaco.mc" class="email">pizzeriamonegasque@monaco.mc</a> , Pizzeria Monégasque ,
Mo-Th 12:00-13:30,19:30-21:30; Fr 12:00-13:30,19:30-22:00; Sa
19:30-22:00, +337 93 30 16 38 , <a href="https://www.pizzeriamonegasque.mc/" class="external-link uri">https://www.pizzeriamonegasque.mc/</a>
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># both: use or to include specific values of different keys and keys</span></span>
<span><span class="va">data</span><span class="op">[</span><span class="va">key</span><span class="op">==</span><span class="st">"shop"</span> <span class="op">|</span> <span class="va">value</span><span class="op">==</span><span class="st">"restaurant"</span>,<span class="op">]</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="1%">
<col width="1%">
<col width="4%">
<col width="0%">
<col width="1%">
<col width="90%">
</colgroup>
<thead><tr class="header">
<th align="left">id</th>
<th align="left">key</th>
<th align="left">value</th>
<th align="right">lon</th>
<th align="right">lat</th>
<th align="left">attrs</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">267885935</td>
<td align="left">shop</td>
<td align="left">supermarket</td>
<td align="right">7.426</td>
<td align="right">43.742</td>
<td align="left">Monaco , 30 , 98000 , Boulevard Princesse Charlotte ,
Marché U , Q2529029 , en:Système U , Marché U , Mo-Sa 08:30-19:30; Su
off , Marché U , +377 93 50 68 60 , <a href="https://www.magasins-u.com/marcheu-montecarlo" class="external-link uri">https://www.magasins-u.com/marcheu-montecarlo</a>
</td>
</tr>
<tr class="even">
<td align="left">267901435</td>
<td align="left">amenity</td>
<td align="left">restaurant</td>
<td align="right">7.425</td>
<td align="right">43.733</td>
<td align="left">Monaco , MC , 6 , 98000 , Quai Antoine 1er , Stars ’n’
Bars , Mo-Su 11:00-00:00 , +377 97 97 95 95 , <a href="https://starsnbars.com/" class="external-link uri">https://starsnbars.com/</a>,
limited</td>
</tr>
<tr class="odd">
<td align="left">267901573</td>
<td align="left">amenity</td>
<td align="left">restaurant</td>
<td align="right">7.424</td>
<td align="right">43.733</td>
<td align="left">MC , 4 , 98000 , Quai Antoine 1er , Quai des Artistes ,
Mo-Su 12:00-14:30, 19:30-23:00, +377 97 97 97 77 , <a href="https://quaidesartistes.com/" class="external-link uri">https://quaidesartistes.com/</a> , yes</td>
</tr>
<tr class="even">
<td align="left">268113123</td>
<td align="left">shop</td>
<td align="left">supermarket</td>
<td align="right">7.428</td>
<td align="right">43.741</td>
<td align="left">Spar , Q610492 , en:Spar (retailer) , Spar , Mo-Sa
07:30-20:00; Su 09:00-19:00, yes</td>
</tr>
<tr class="odd">
<td align="left">268113334</td>
<td align="left">shop</td>
<td align="left">electronics</td>
<td align="right">7.428</td>
<td align="right">43.741</td>
<td align="left">Fnac , Q676585, Fnac , yes</td>
</tr>
<tr class="even">
<td align="left">268113343</td>
<td align="left">shop</td>
<td align="left">convenience;doityourself</td>
<td align="right">7.429</td>
<td align="right">43.743</td>
<td align="left">NULL</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="filtering-2nd-level-tags">Filtering 2nd level tags<a class="anchor" aria-label="anchor" href="#filtering-2nd-level-tags"></a>
</h2>
<p>A function to efficiently filter the secondary tags returns a data
frame, where the searched for key will be added as a column for all
feature that has a non-<code>NA</code> match. Under the hood, values are
matched using regular expressions, which maximises the chance of finding
the desired values in sometimes complicated OSM values.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">cppRosm</span><span class="fu">::</span><span class="fu"><a href="../reference/filter_sec.html">filter_sec</a></span><span class="op">(</span>keys<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cuisine"</span>,<span class="st">"takeaway"</span><span class="op">)</span></span>
<span>                      ,cores<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="2%">
<col width="1%">
<col width="2%">
<col width="1%">
<col width="1%">
<col width="84%">
<col width="3%">
<col width="2%">
</colgroup>
<thead><tr class="header">
<th align="left">id</th>
<th align="left">key</th>
<th align="left">value</th>
<th align="right">lon</th>
<th align="right">lat</th>
<th align="left">attrs</th>
<th align="left">cuisine</th>
<th align="left">takeaway</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">321647302</td>
<td align="left">amenity</td>
<td align="left">restaurant</td>
<td align="right">7.422</td>
<td align="right">43.734</td>
<td align="left">MC , 250 , pizza;burger , wlan , yes , yes , Brasserie
de Monaco , +377 97 98 51 20 , <a href="http://www.bar-brasseriedemonaco.com" class="external-link uri">http://www.bar-brasseriedemonaco.com</a>, limited</td>
<td align="left">pizza;burger</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">917978763</td>
<td align="left">amenity</td>
<td align="left">cafe</td>
<td align="right">7.422</td>
<td align="right">43.731</td>
<td align="left">MC , ice_cream , Snack Bar La Pampa, no</td>
<td align="left">ice_cream</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">1306031292</td>
<td align="left">amenity</td>
<td align="left">restaurant</td>
<td align="right">7.418</td>
<td align="right">43.733</td>
<td align="left">MC , italian, P&amp;P</td>
<td align="left">italian</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">1306034043</td>
<td align="left">amenity</td>
<td align="left">cafe</td>
<td align="right">7.421</td>
<td align="right">43.737</td>
<td align="left">MC , ice_cream , La Gelateria</td>
<td align="left">ice_cream</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">1306037369</td>
<td align="left">amenity</td>
<td align="left">restaurant</td>
<td align="right">7.420</td>
<td align="right">43.734</td>
<td align="left">MC , 2 , 98000 , Rue des Orangers , sushi , My Sushi ,
<a href="https://www.mysushi.com/" class="external-link uri">https://www.mysushi.com/</a>
</td>
<td align="left">sushi</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">1661166947</td>
<td align="left">amenity</td>
<td align="left">fast_food</td>
<td align="right">7.417</td>
<td align="right">43.729</td>
<td align="left">MC , 4 , Avenue des Papalins, +337 97 98 34 44 ,
sandwich , L’En-K</td>
<td align="left">sandwich</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">cppRosm</span><span class="fu">::</span><span class="fu"><a href="../reference/filter_sec.html">filter_sec</a></span><span class="op">(</span>keys<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"cuisine"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"japanese"</span>,<span class="st">"pizza"</span><span class="op">)</span></span>
<span>                                ,<span class="st">"takeaway"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yes"</span><span class="op">)</span><span class="op">)</span></span>
<span>                      ,cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Searching for exact key~value matches.</span></span></code></pre>
<table class="table">
<colgroup>
<col width="1%">
<col width="0%">
<col width="1%">
<col width="0%">
<col width="0%">
<col width="93%">
<col width="1%">
<col width="0%">
</colgroup>
<thead><tr class="header">
<th align="left">id</th>
<th align="left">key</th>
<th align="left">value</th>
<th align="right">lon</th>
<th align="right">lat</th>
<th align="left">attrs</th>
<th align="left">cuisine</th>
<th align="left">takeaway</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">321647302</td>
<td align="left">amenity</td>
<td align="left">restaurant</td>
<td align="right">7.422</td>
<td align="right">43.734</td>
<td align="left">MC , 250 , pizza;burger , wlan , yes , yes , Brasserie
de Monaco , +377 97 98 51 20 , <a href="http://www.bar-brasseriedemonaco.com" class="external-link uri">http://www.bar-brasseriedemonaco.com</a>, limited</td>
<td align="left">pizza;burger</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">1790048266</td>
<td align="left">amenity</td>
<td align="left">fast_food</td>
<td align="right">7.418</td>
<td align="right">43.731</td>
<td align="left">MC , yes , McDonald’s , Q38076 , en:McDonald’s , burger
, no , yes , wlan , 1 , McDonald’s , 07:00-22:00 , yes , +37792053990 ,
outside , yes , <a href="https://www.restaurants.mcdonalds.fr/mcdonalds-monaco" class="external-link uri">https://www.restaurants.mcdonalds.fr/mcdonalds-monaco</a>
</td>
<td align="left">burger</td>
<td align="left">yes</td>
</tr>
<tr class="odd">
<td align="left">2622751936</td>
<td align="left">amenity</td>
<td align="left">fast_food</td>
<td align="right">7.420</td>
<td align="right">43.733</td>
<td align="left">MC , pasta , Vente à emporter chaud , <a href="https://www.facebook.com/Maisondespatesmonaco?_rdc=1&amp;_rdr" class="external-link uri">https://www.facebook.com/Maisondespatesmonaco?_rdc=1&amp;_rdr</a>,
La maison des pâtes , Tu-Sa 07:00-15:30,18:00-22:00; Su,Mo 07:00-15:30 ,
+377 97 77 56 21 , yes</td>
<td align="left">pasta</td>
<td align="left">yes</td>
</tr>
<tr class="even">
<td align="left">2680832184</td>
<td align="left">amenity</td>
<td align="left">restaurant</td>
<td align="right">7.421</td>
<td align="right">43.735</td>
<td align="left">yes , MC , japanese , yes , no , Planet Sushi , no , <a href="http://commande.planetsushi.fr/nos-restaurants/planet-sushi-monaco" class="external-link uri">http://commande.planetsushi.fr/nos-restaurants/planet-sushi-monaco</a>,
limited</td>
<td align="left">japanese</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">3365391451</td>
<td align="left">amenity</td>
<td align="left">fast_food</td>
<td align="right">7.421</td>
<td align="right">43.734</td>
<td align="left">Monaco , MC , 1 , 98000 , Rue Louis Notari, U Picin
Tocu , +377 93 50 34 40, yes</td>
<td align="left">NA</td>
<td align="left">yes</td>
</tr>
<tr class="even">
<td align="left">3944391377</td>
<td align="left">amenity</td>
<td align="left">restaurant</td>
<td align="right">7.423</td>
<td align="right">43.733</td>
<td align="left">Monaco , MC , 6 , 98000 , Route de la Piscine, pizza ,
Crazy Pizza Monaco</td>
<td align="left">pizza</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="geometries">Geometries<a class="anchor" aria-label="anchor" href="#geometries"></a>
</h2>
<p>In a lot of cases, knowing the centroids of POIs is more than
enough:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>,<span class="st">"lat"</span><span class="op">)</span>,crs<span class="op">=</span><span class="fl">4326</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>pch<span class="op">=</span><span class="fl">19</span><span class="op">)</span></span></code></pre></div>
<p><img src="data_schema_files/figure-html/unnamed-chunk-9-1.png" width="576"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># or same result, keeping the original data a `data.table`</span></span>
<span><span class="co"># data |&gt; </span></span>
<span><span class="co">#   cppRosm::construct_geom() |&gt; </span></span>
<span><span class="co">#   sf::st_as_sf() |&gt; </span></span>
<span><span class="co">#   sf::st_geometry() |&gt; </span></span>
<span><span class="co">#   plot()</span></span></code></pre></div>
<p>But there will be times when the original geometry might be of
interest, in this case use the <code>construct_geom</code> function:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_geom</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">cppRosm</span><span class="fu">::</span><span class="fu"><a href="../reference/construct_geom.html">construct_geom</a></span><span class="op">(</span>complete <span class="op">=</span> <span class="cn">TRUE</span>,cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_geom</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>pch<span class="op">=</span><span class="fl">19</span><span class="op">)</span></span></code></pre></div>
<p><img src="data_schema_files/figure-html/unnamed-chunk-10-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="buildings">Buildings<a class="anchor" aria-label="anchor" href="#buildings"></a>
</h2>
<p>As discussed earlier, the tags withe the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mi>u</mi><mi>i</mi><mi>l</mi><mi>d</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow><annotation encoding="application/x-tex">building</annotation></semantics></math>
key arguably fall into neither categories, and in that sense they
constitute a data layer, just like the road network. They can still be
queried and extracted with the <code>extract_data</code> function.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">buildings</span> <span class="op">&lt;-</span> <span class="fu">cppRosm</span><span class="fu">::</span><span class="fu"><a href="../reference/extract_data.html">extract_data</a></span><span class="op">(</span><span class="va">test_file</span>,main_keys <span class="op">=</span> <span class="st">"building"</span><span class="op">)</span></span></code></pre></div>
<p>This function will run in a fraction of seconds and extract all the
buildings from the file. It will again only provide the centroid in
direct access:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">buildings</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">cppRosm</span><span class="fu">::</span><span class="fu"><a href="../reference/construct_geom.html">construct_geom</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_set_geometry</a></span><span class="op">(</span><span class="st">"geometry"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>pch<span class="op">=</span><span class="fl">19</span><span class="op">)</span></span></code></pre></div>
<p><img src="data_schema_files/figure-html/unnamed-chunk-12-1.png" width="576"></p>
<p>And we can reconstruct the geometries from the data hidden in
<code>attrs</code> as follows:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">buildings</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">cppRosm</span><span class="fu">::</span><span class="fu"><a href="../reference/construct_geom.html">construct_geom</a></span><span class="op">(</span>complete <span class="op">=</span> <span class="cn">TRUE</span>,cores<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>pch<span class="op">=</span><span class="fl">19</span><span class="op">)</span></span></code></pre></div>
<p><img src="data_schema_files/figure-html/unnamed-chunk-13-1.png" width="576"></p>
<p>We can filter for specific tags:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">buildings</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">cppRosm</span><span class="fu">::</span><span class="fu"><a href="../reference/filter_sec.html">filter_sec</a></span><span class="op">(</span>keys<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"shop"</span>,<span class="st">"amenity"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">!</span><span class="va">attrs</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">id</th>
<th align="left">key</th>
<th align="left">value</th>
<th align="right">lon</th>
<th align="right">lat</th>
<th align="left">amenity</th>
<th align="left">shop</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">49209406</td>
<td align="left">building</td>
<td align="left">hospital</td>
<td align="right">7.411</td>
<td align="right">43.730</td>
<td align="left">hospital</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">49209608</td>
<td align="left">building</td>
<td align="left">public</td>
<td align="right">7.422</td>
<td align="right">43.730</td>
<td align="left">courthouse</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">49209620</td>
<td align="left">building</td>
<td align="left">chapel</td>
<td align="right">7.426</td>
<td align="right">43.732</td>
<td align="left">place_of_worship</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">49209626</td>
<td align="left">building</td>
<td align="left">yes</td>
<td align="right">7.422</td>
<td align="right">43.731</td>
<td align="left">restaurant</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">49209644</td>
<td align="left">building</td>
<td align="left">chapel</td>
<td align="right">7.423</td>
<td align="right">43.731</td>
<td align="left">place_of_worship</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">94252399</td>
<td align="left">building</td>
<td align="left">hospital</td>
<td align="right">7.425</td>
<td align="right">43.738</td>
<td align="left">hospital</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p>We observe the mutually exclusive nature of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>i</mi><mi>t</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">amenity</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>h</mi><mi>o</mi><mi>p</mi></mrow><annotation encoding="application/x-tex">shop</annotation></semantics></math>
keys, justifying the earlier discussion and the differentiation of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mi>u</mi><mi>i</mi><mi>l</mi><mi>d</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow><annotation encoding="application/x-tex">building</annotation></semantics></math>
key. The only intersection of the two keys is the famous in french
<em>bar-tabac</em>, which is both a bar and a place to buy
tobacco/cigarettes.</p>
<p>More specific filtering:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">buildings</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">cppRosm</span><span class="fu">::</span><span class="fu"><a href="../reference/filter_sec.html">filter_sec</a></span><span class="op">(</span>keys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"tourism"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span>
<span>                         ,<span class="st">"abandoned"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yes"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">!</span><span class="va">attrs</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Searching for exact key~value matches.</span></span></code></pre>
<table class="table">
<thead><tr class="header">
<th align="left">id</th>
<th align="left">key</th>
<th align="left">value</th>
<th align="right">lon</th>
<th align="right">lat</th>
<th align="left">tourism</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">23715051</td>
<td align="left">building</td>
<td align="left">public</td>
<td align="right">7.426</td>
<td align="right">43.731</td>
<td align="left">museum</td>
</tr>
<tr class="even">
<td align="left">94399465</td>
<td align="left">building</td>
<td align="left">yes</td>
<td align="right">7.426</td>
<td align="right">43.741</td>
<td align="left">information</td>
</tr>
<tr class="odd">
<td align="left">94399684</td>
<td align="left">building</td>
<td align="left">hotel</td>
<td align="right">7.421</td>
<td align="right">43.736</td>
<td align="left">hotel</td>
</tr>
<tr class="even">
<td align="left">94399793</td>
<td align="left">building</td>
<td align="left">yes</td>
<td align="right">7.428</td>
<td align="right">43.741</td>
<td align="left">hotel</td>
</tr>
<tr class="odd">
<td align="left">94400040</td>
<td align="left">building</td>
<td align="left">yes</td>
<td align="right">7.422</td>
<td align="right">43.739</td>
<td align="left">hotel</td>
</tr>
<tr class="even">
<td align="left">94400205</td>
<td align="left">building</td>
<td align="left">yes</td>
<td align="right">7.421</td>
<td align="right">43.736</td>
<td align="left">hotel</td>
</tr>
</tbody>
</table>
<p>If searching for a specific
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mi>e</mi><mi>y</mi><mo>=</mo><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">key=value</annotation></semantics></math>
in one tag and all values for another tag, consider the trick above.</p>
<ul>
<li>It’s generally not recommended to extract the building layer
together with other main keys.</li>
</ul>
</div>
<div class="section level2">
<h2 id="alternatives">Alternatives<a class="anchor" aria-label="anchor" href="#alternatives"></a>
</h2>
<ul>
<li>
<code>osmdata</code>: while this is a great package that I have used
a lot, I found it frustrating to have all the different geometries
gathered into separate tables, and each table containing huge numbers of
<code>NA</code> columns. The <code>attrs</code> column in a cppRosm
table provides an alternative way to store all the secondary tags.
Additionally, all the geometries are simplified to their centroid, but
the possibility to reconstruct the original ones are provided with the
<code>construct_geom</code> function.</li>
<li>
<code>osmextract</code>: great for working with large OSM files. But
the filtering of features remains a bit obscure in my opinion, although
it seems to provide great flexibility, but requires a good knowledge of
OSM internals.</li>
</ul>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>This vignette aimed to explain the approach taken for manipulating
OSM data at scale and with flexibility through a specific data table
format and supporting functions. Please reach out for recommendations,
feature additions etc…</p>
<p>In another vignette, a recommended workflow will be covered, as this
package was developed with a few others in mind
(<code>rosmium</code>,<code>cppRouting</code> mainly) , so that network
and POI analysis could be done at scale in a local setup.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ivann Schlosser.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
